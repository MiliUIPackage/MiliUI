------------------------------------------------ 聊天超鏈接增加物品等級-- @Author:M----------------------------------------------local tooltip = CreateFrame("GameTooltip", "ChatLinkLevelTooltip", UIParent, "GameTooltipTemplate")local ItemLevelPattern = gsub(ITEM_LEVEL, "%%d", "(%%d+)")local ARMOR = ARMOR or "Armor"local WEAPON = WEAPON or "Weapon"--檢查是否帶洞--function borrowed from ItemLinkLevellocal SOCKET_STATS = {	'EMPTY_SOCKET_RED',	'EMPTY_SOCKET_YELLOW',	'EMPTY_SOCKET_BLUE',	'EMPTY_SOCKET_META',	'EMPTY_SOCKET_PRISMATIC',	'EMPTY_SOCKET_DOMINATION',}local function ItemHasSockets(itemLink)	local itemStats = C_Item.GetItemStats(itemLink)		if itemStats == nil then return false end	local socketCount = 0	for _, socketStat in pairs(SOCKET_STATS) do		socketCount = socketCount + (itemStats[socketStat] or 0)	end	return socketCount > 0end--获取物品实际等级local function GetItemLevelAndTexture(ItemLink)    local _, _, _, _, _, class, subclass, _, equipSlot, texture, _, classId, subClassId = C_Item.GetItemInfo(ItemLink)	if (not texture) then return end	-- 不是護甲或武器直接傳回	if (classId ~= Enum.ItemClass.Armor) and (classId ~= Enum.ItemClass.Weapon) then return end    local text, level, slotText	-- 取得物品實際等級	level = C_Item.GetDetailedItemLevelInfo(ItemLink)    if (equipSlot and string.find(equipSlot, "INVTYPE_")) then        slotText = _G[equipSlot] or equipSlot		--加上護甲類型		--code borrowed from ItemLinkLevel		if (classId == Enum.ItemClass.Armor and subClassId == 0) then		-- 不顯示雜項 (戒指、項鍊、飾品)			elseif (classId == Enum.ItemClass.Armor and equipSlot == "INVTYPE_CLOAK") then		-- 不顯示布甲披風		elseif (classId == Enum.ItemClass.Weapon) then		-- 武器			slotText = slotText .. subclass		else			slotText = subclass .. slotText:gsub("部","")		end		--加上+洞		--code borrowed from ItemLinkLevel		if (ItemHasSockets(ItemLink)) then slotText = "+洞 " .. slotText end    elseif (classId == Enum.ItemClass.Armor) then        slotText = class    -- elseif (subclass and string.find(subclass, RELICSLOT)) then    --    slotText = PLH_GetRelicType(ItemLink) .. RELICSLOT    end	    if (level and slotText) then        level = level .. " " .. slotText    end    return level, textureend--等级图标显示local function SetChatLinkLevel(Hyperlink)    local link = string.match(Hyperlink, "|H(.-)|h")    local level, texture = GetItemLevelAndTexture(link)    if (level) then        Hyperlink = Hyperlink:gsub("|h%[(.-)%]|h", "|h["..level.."：%1]|h")    end    return Hyperlinkend--过滤器local function filter(self, event, msg, ...)    if (not TinyChatDB or not TinyChatDB.HideLinkLevel) then		msg = msg:gsub("(|Hitem:%d+:.-|h.-|h)", SetChatLinkLevel)    end    return false, msg, ...endChatFrame_AddMessageEventFilter("CHAT_MSG_CHANNEL", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_SAY", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_YELL", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_BN_WHISPER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER_INFORM", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID_LEADER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY_LEADER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_GUILD", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_BATTLEGROUND", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_LOOT", filter)-- ChatFrame_AddMessageEventFilter("CHAT_MSG_SYSTEM", filterSystem)